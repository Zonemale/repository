<html>
<head>
  <title>ajax&amp;json</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600388 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1944"/>
<h1>ajax&amp;json</h1>

<div>
<span><div><div><font style="font-size: 14pt;"><span style="font-size: 14pt; font-weight: bold;">一、AJAX</span></font></div><div><span style="font-size: 14pt;"><span style="font-size: 14pt; font-weight: bold;"><img src="ajax&json_files/1.同步和异步.bmp" type="image/bmp" data-filename="1.同步和异步.bmp"/></span></span></div><ol><li><div><span style="font-size: 12pt;">概念：Asynchronous JavaScript And XML,异步的JavaScript和XML</span></div></li><ol><li><div><span style="font-size: 12pt;">异步和同步：客户端和服务器端相互通信的基础上</span></div></li><ol><li><div><span style="font-size: 16px;">同步：客户端在发送请求后必须等待服务器端的响应，在等待期间不能做其他事情</span></div></li><li><div><span style="font-size: 16px;">异步：客户端不必等待服务端的响应，在服务器处理请求的过程中，<span style="font-size: 16px; color: rgb(45, 79, 201);">客户端可以继续进行其他的操作</span></span></div></li><li><div><span style="font-size: 16px;">Ajax是一种<span style="font-size: 16px; color: rgb(45, 79, 201);">无需重新加载整个网页的情况下，能够更新部分网页的技术</span></span></div></li><li><div><span style="font-size: 16px;">通过在后台与服务器进行少量数据交换，Ajax可以使网页实现</span><span style="font-size: 16px; color: rgb(45, 79, 201);">异步更新</span><span style="font-size: 16px;">。这意味着可以在不重新加载整个网页的情况下，对网页的</span><span style="font-size: 16px; color: rgb(45, 79, 201);">某部分进行更新</span></div></li><li><div><span style="font-size: 16px;">Ajax可以提升用户体验</span></div></li></ol></ol><li><div><span style="font-size: 16px;">实现方式：</span></div></li><ul><li><div><span style="font-size: 16px;">原生js实现方式：</span></div></li></ul></ol><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>function fun(){</div><div><br/></div><div>    //1.创建ajax请求对象</div><div>    var xmlhttp;</div><div>    if(window.XMLHttpRequest){</div><div>        xmlhttp = new XMLHttpRequest();</div><div>    }else if(window.ActiveXObject){</div><div>        xmlhttp = new XMLHttpRequest();</div><div>    }</div><div><br/></div><div>    //2.建立连接</div><div>    xmlhttp.open(&quot;GET&quot;,&quot;ajaxServlet?name=what&amp;age=23&quot;,true);</div><div><br/></div><div>    //3.发送请求</div><div>    xmlhttp.send();</div><div><br/></div><div>    //4.接收并响应响应数据</div><div>    <font color="#FF0000">//readyState=4代表响应已经就绪，准备响应</font></div><div>    xmlhttp.onreadystatechange = function(){</div><div><br/></div><div>        if(xmlhttp.readyState == 4 &amp;&amp; xmlhttp.status == 200){</div><div>            var response = xmlhttp.responseText;</div><div>            alert(response);</div><div>        }</div><div>    }</div><div>}</div></div><ul><li><div><span style="font-size: 16px;">JQuery实现方式：</span></div></li><ul><li><div><span style="font-size: 12pt;">$.ajax()</span></div></li></ul></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>function fun(){</div><div><br/></div><div>    $.ajax({</div><div>        url:&quot;ajaxServlet&quot;,</div><div>        type:&quot;POST&quot;,</div><div>        data:{&quot;name&quot;:&quot;what&quot;,&quot;age&quot;:23},</div><div>        success:function(msg){</div><div>            alert(msg);</div><div>        },</div><div>        error:function () {</div><div>            alert(&quot;请求错误&quot;);</div><div>        },</div><div>        dataType:&quot;text&quot;</div><div>    });</div><div>}</div></div><ul><ul><li><div><span style="font-size: 12pt;">$.get()</span></div></li><ul><li><div><span style="font-size: 16px;">语法：$get(url,[data],[callback],[type])</span></div></li><li><div><span style="font-size: 16px;">参数：</span></div></li><ul><li><div><span style="font-size: 16px;">url：请求路径</span></div></li><li><div><span style="font-size: 16px;">data：请求参数</span></div></li><li><div><span style="font-size: 16px;">callback：回调函数</span></div></li><li><div><span style="font-size: 16px;">type：响应结果的类型</span></div></li></ul></ul><li><div><span style="font-size: 12pt;">$post()：同$.get()</span></div></li><li><div><span style="font-size: 12pt;">jQuery对象.load(url,data,callback):将HTML文件加载进调用该方法的标签内</span></div></li><ul><li><div><span style="font-size: 16px;">如果有参数，使用post提交，如果没有参数，使用get提交</span></div></li><li><div><span style="font-size: 16px;">callback一般不用</span></div></li><li><div><span style="font-size: 16px;">例：$(&quot;#div&quot;).load(&quot;ajaxServlet&quot;):将ajaxServlet响应的数据，填充到#div代表的元素内部，作为该标签提的内容</span></div></li></ul></ul></ul><div><br/></div><div><span style="font-size: 14pt; font-weight: bold;">二、JSON</span></div><ol><li><div><span style="font-size: 12pt;">概念：JavaScript Object Notation     JavaScript对象表示法</span></div></li><ol><li><div><span style="font-size: 16px;">json现在多用于存储和交换文本信息的语法</span></div></li><li><div><span style="font-size: 16px;">进行数据的传输</span></div></li><li><div><span style="font-size: 16px;">json比xml更小，更快，更易解析</span></div></li></ol><li><div><span style="font-size: 16px;">语法：</span></div></li><ol><li><div><span style="font-size: 12pt;">基本规则</span></div></li><ul><li><div><span style="font-size: 16px;">数据在名称/值对中：json数据是由键值对构成的</span></div></li><ol><li><div><span style="font-size: 16px;">键用引号（单双都行）引起来，也可以不使用引号</span></div></li><li><div><span style="font-size: 16px;">值的取值类型</span></div></li><ol><li><div><span style="font-size: 16px;">数字</span></div></li><li><div><span style="font-size: 16px;">字符串</span></div></li><li><div><span style="font-size: 16px;">逻辑值</span></div></li><li><div><span style="font-size: 16px;">对象</span></div></li><li><div><span style="font-size: 16px;">null</span></div></li></ol></ol><li><div><span style="font-size: 16px;">数据由逗号分割：多个键值对由逗号分隔</span></div></li></ul></ol></ol><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>var person = {</div><div>    &quot;name&quot;:&quot;张三&quot;,</div><div>    &quot;age&quot;:24,</div><div>    &quot;gender&quot;:&quot;男&quot;</div><div>}</div></div><ul><ul><ul><li><div><span style="font-size: 16px;">花括号保存对象</span></div></li></ul></ul></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>var psersons = {</div><div>    &quot;psersons&quot;:[</div><div>        {&quot;name&quot;:&quot;李四&quot;,&quot;age&quot;:25,&quot;gender&quot;:&quot;女&quot;},</div><div>        {&quot;name&quot;:&quot;王五&quot;,&quot;age&quot;:26,&quot;gender&quot;:&quot;黑色&quot;},</div><div>        {&quot;name&quot;:&quot;赵柳&quot;,&quot;age&quot;:27,&quot;gender&quot;:&quot;male&quot;}</div><div>        ]</div><div>};</div></div><ul><ul><ul><li><div><span style="font-size: 16px;">方括号保存数组</span></div></li></ul></ul></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>var arr = [</div><div>    {&quot;name&quot;:&quot;李四&quot;,&quot;age&quot;:25,&quot;gender&quot;:&quot;女&quot;},</div><div>    {&quot;name&quot;:&quot;王五&quot;,&quot;age&quot;:26,&quot;gender&quot;:&quot;黑色&quot;},</div><div>    {&quot;name&quot;:&quot;赵柳&quot;,&quot;age&quot;:27,&quot;gender&quot;:&quot;male&quot;}</div><div>    ];</div></div><ol><ol><li><div><span style="font-size: 16px;">获取数据</span></div></li><ol><li><div><span style="font-size: 16px;">json对象.键名</span></div></li><li><div><span style="font-size: 12pt;">json对象[&quot;键名&quot;]</span></div></li><li><div><span style="font-size: 16px;">数组对象[索引]</span></div></li></ol></ol><li><div><span style="font-size: 16px;">接送数据和java对象的相互转换</span></div></li><ol><li><div><span style="font-size: 12pt;">JSON解析器：</span></div></li><ol><li><div><span style="font-size: 16px;">常见解析器：Jsonlib,Gson,fastjson,jackson</span></div></li></ol><li><div><span style="font-size: 16px;"><span style="font-size: 16px; color: rgb(255, 0, 0);">JSON转为Java对象</span></span></div></li><ol><li><div><span style="font-size: 16px;">导入Jackson的相关jar包</span></div></li><li><div><span style="font-size: 16px;"><span style="font-size: 16px; color: rgb(54, 101, 238);">创建Jackson核心对象，ObjectMapper</span></span></div></li><li><div><span style="font-size: 16px;">调用ObjectMapper的相关方法进行转换</span></div></li><ol><li><div><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(54, 101, 238);">readValue(json字符串数据,Class)</span></span></div></li></ol></ol><li><div><span style="font-size: 16px;"><span style="font-size: 16px; color: rgb(255, 0, 0);">Java对象转为JSON：</span></span></div></li><ol><li><div><span style="font-size: 16px;">使用步骤</span></div></li><ol><li><div><span style="font-size: 16px;">导入jackson相关jar包</span></div></li><li><div><span style="font-size: 16px;">创建Jackson核心对象，ObjectMapper</span></div></li><li><div><span style="font-size: 16px;"><span style="font-size: 16px; color: rgb(255, 0, 0);">调用ObjectMapper的相关方法进行转换</span></span></div></li></ol><li><div><span style="font-size: 16px;">转换方法：</span></div></li><ol><li><div><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(54, 101, 238);">writeValue(参数1,obj):</span></span></div></li><ol><li><div><span style="font-size: 16px;">参数1</span></div></li><ol><li><div><span style="font-size: 16px;"><span style="font-size: 16px; color: rgb(166, 0, 196);">File：将ObjectMapper对象转换为JSON字符串，并保存到指定文件中</span></span></div></li><li><div><span style="font-size: 16px;"><span style="font-size: 16px; color: rgb(166, 0, 196);">Writer：将obj对象转换为 JSON字符串，并将JSON数据填充到字符串中</span></span></div></li><li><div><span style="font-size: 16px;"><span style="font-size: 16px; color: rgb(166, 0, 196);">OutputStream：将obj对象转换为JSON字符串，并将json数据填充到字节输出流中</span></span></div></li></ol></ol><li><div><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(54, 101, 238);">writeValueAsString(obj)</span>:将对象转为json格式的字符串</span></div></li></ol><li><div><span style="font-size: 16px;">注解：</span></div></li><ol><li><div><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(166, 0, 196);">@JsonIgnore:排除属性</span></span></div></li><li><div><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(166, 0, 196);">@JsonFormat:属性值格式化</span></span></div></li></ol><li><div><span style="font-size: 16px;">复杂Java对象转化</span></div></li><ol><li><div><span style="font-size: 12pt;">List:数组</span></div></li><li><div><span style="font-size: 12pt;">Map：与对象格式一致</span></div></li><li><div><span style="font-size: 16px; color: rgb(255, 0, 0);">JavaBean对象--&gt;JSON    {属性：值，属性，值......}</span></div></li><li><div><span style="font-size: 12pt; color: rgb(255, 0, 0);">List/Arrays/Set --&gt;JSON    [{属性：值，属性：值}，{属性：值}....]</span></div></li></ol></ol></ol><li><div><span style="font-size: 12pt;">服务器响应的数据，在客户端使用时，要想当做json数据格式使用。有两种解决方案：</span></div></li><ol><li><div><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(147, 150, 0);">$.get(type):将最后一个参数type指定为&quot;json&quot;</span></span></div></li><li><div><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(147, 150, 0);">在服务器端设置MIME类型</span></span></div></li><ul><li><div><span style="font-size: 12pt;">response.setContentType(&quot;application/json;charset=utf-8&quot;);</span></div></li></ul></ol><li><div><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(147, 150, 0);">注意：异步访问的Servlet，Servlet所有响应都会在回调函数的data中体现，即便是跳转页面，那么data会是这个页面的源代码。</span></span></div></li></ol><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>一、同步和异步</div><div>1.open方法的第二个参数是url，第三个参数可以传入一个布尔值，默认为true，即异步模式</div><div>2.主要事件注册时间问题</div><div>3.responseXML获取服务端返回的XML数据，以DOM方式操作，但是需要服务端响应的中的Contype-Type 必须是application/xml</div><div>4.this.responseText永远获取的是字符串形式的响应体</div><div>5.this.reponse获取到的结果会根据this.responseType的变化而变化</div><div>二、</div><div>1）var xhr = new XMLHttpRequest(); //创建一个XMLHttprequest()</div><div>2)xhr.open('GET','./time.php');    //打开与一个地址之间的连接，相当于在地址栏输入地址</div><div>3)xhr.send(null);    //通过连接发送一次请求，相当于回车或单击访问发送请求</div><div>4)xhr.onreadystatechange = function(){    //指定xhr状态变化事件处理函数，相当于处理网页呈现处理后的操作</div><div>    if(this.readyState ===4){    //通过xhr的readyState判断此次请求的数据是否接收完成</div><div>    console.log(this.responseText);    //通过xhr的responseText获取响应数据</div><div>    }</div><div>    </div><div>}</div><div>5)post请求需要设置请求头</div><div>xhr.setRequestHeader('Content-type','application/x-www-form-urlencoded');</div><div>6)JSON.parse();//将JSON格式的字符串转换为对象</div><div>三、进程与线程</div><div>1.进程：进行中的程序</div><div>2.线程：线程就是拿着剧本（代码）去演戏的演员</div><div>3.多线程技术：计算机单核可以同时执行多个事情</div><div>四、回调函数</div><div>五、跨域</div><div>1.同源策略：浏览器指定两个URL地址之间只有域名、协议、端口完全相同才叫同源-----不同源地址之间，默认不能相互发送ajax请求</div><div>六、JSONP原理</div><div>通过script标签请求一个服务端的PHP文件，这个文件返回的结果是一段js，作用是调用我们事先定义好的一个函数，从而将服务端要给客户端发过去的数据发送给客户端</div><div>七、数据格式</div><div>1.</div><div><br/></div><div>八、模板引擎</div><div>1.模板的typa = &quot;text/html&quot;</div><div>2.id = &quot;resultTemplate&quot;</div><div>3.template方法的含义就是将数据和模板结合起来，生成HTML片段</div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></div><div><br/></div></span>
</div></body></html> 