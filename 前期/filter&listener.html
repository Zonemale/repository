<html>
<head>
  <title>filter&amp;listener</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600388 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1932"/>
<h1>filter&amp;listener</h1>

<div>
<span><div><div><span style="font-size: 14pt; font-weight: bold;">一、filter过滤器</span></div><ol><li><div><span style="font-size: 16px;">web中的过滤器：当访问服务器的资源时，过滤器可以将请求拦截下来，完成一些特殊的功能</span></div></li><li><div><span style="font-size: 16px;">过滤器的作用：（完成一些通用的功能）</span></div></li><ol><li><div><span style="font-size: 16px;">一般用于</span><span style="font-size: 16px; color: rgb(227, 0, 0); font-weight: bold;">完成通用的操作</span><span style="font-size: 16px;">。如：登录验证，设置编码，敏感字符过滤......</span></div></li></ol><li><div><span style="font-size: 16px;">快速入门：</span></div></li><ol><li><div><span style="font-size: 16px;">步骤：</span></div></li><ol><li><div><span style="font-size: 16px;">定义一个类，实现接口Filter</span></div></li><li><div><span style="font-size: 16px;">复写doFilter方法</span></div></li><li><div><span style="font-size: 16px;"><span style="font-size: 16px; color: rgb(54, 101, 238);">配置拦截路径</span></span></div></li><ul><li><div>web.xml</div></li></ul></ol></ol></ol><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>&lt;filter&gt;</div><div>    &lt;filter-name&gt;demo2&lt;/filter-name&gt;</div><div>    &lt;filter-class&gt;filter.FilterDemo2&lt;/filter-class&gt;</div><div>&lt;/filter&gt;</div><div>&lt;filter-mapping&gt;</div><div>    &lt;filter-name&gt;demo2&lt;/filter-name&gt;</div><div>    &lt;!--拦截路径--&gt;</div><div>    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;</div><div>&lt;/filter-mapping&gt;</div></div><ul><ul><ul><ul><li><div><span style="font-size: 12pt;">注解</span>：<span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(128, 128, 0); font-family: &quot;Droid Sans Mono&quot;;">@WebFilter</span><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(0, 0, 0); font-family: &quot;Droid Sans Mono&quot;;">(</span><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(0, 128, 0); font-family: &quot;Droid Sans Mono&quot;; font-weight: bold;">&quot;/*&quot;</span><span style="font-size: 12pt; color: rgb(0, 0, 0); font-family: &quot;Droid Sans Mono&quot;;">)</span></div></li></ul></ul></ul></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>@WebFilter(&quot;/*&quot;)//&quot;/*&quot;表示访问所有资源之前，都会执行该过滤器</div><div>public class FilterDemo1 implements Filter {</div><div>    @Override</div><div>    public void init(FilterConfig filterConfig) throws ServletException {</div><div><br/></div><div>    }</div><div><br/></div><div>    @Override</div><div>    public void doFilter(<b><font color="#FF0000">ServletRequest servletRequest, ServletResponse servletResponse,</font> <font color="#A600C4">FilterChain filterChain</font></b>) throws IOException, ServletException {</div><div><br/></div><div>        filterChain.doFilter(servletRequest,servletResponse);</div><div><br/></div><div>        System.out.println(&quot;filterDemo1被执行了......&quot;);</div><div>    }</div><div><br/></div><div>    @Override</div><div>    public void destroy() {</div><div><br/></div><div>    }</div><div>}</div></div><ul><li><div><span style="font-size: 16px;">过滤器细节</span></div></li><ul><li><div><span style="font-size: 16px;">web.xml配置</span></div></li><li><div><span style="font-size: 16px;">过滤器的执行流程</span></div></li><ul><li><div><span style="font-size: 16px;">执行过滤器</span></div></li><li><div><span style="font-size: 16px;">执行放行后的资源</span></div></li><li><div><span style="font-size: 16px;"><span style="font-size: 16px; color: rgb(255, 0, 0);">回来执行过滤器放行代码下边的代码  </span></span></div></li></ul><li><div><span style="font-size: 16px;">过滤器的生命周期方法</span></div></li><ul><li><div><span style="font-size: 16px;">在</span><span style="font-size: 16px; color: rgb(222, 87, 0);">服务器启动后</span><span style="font-size: 16px;">，会创建Filter对象，然后调用init(FilterConfig config)方法，</span><span style="font-size: 16px;">只执行一次，<span style="font-size: 16px; color: rgb(255, 0, 0);">用于加载资源</span></span></div></li><li><div><span style="font-size: 16px;">每一次</span><span style="font-size: 16px; color: rgb(255, 0, 0);">请求被拦截资源时</span><span style="font-size: 16px;">，会执行doFilter(ServletContext req,ServletContext resp,FilterChain chain)方法，<span style="font-size: 16px; color: rgb(222, 87, 0);">执行多次</span></span></div></li><li><div><span style="font-size: 16px;"><span style="font-size: 16px; color: rgb(255, 0, 0);">在服务器关闭后，Filter对象被销毁</span>，如果服务器是正常关闭 ，则会执行destroy方法，只执行一次，用于释放资源</span></div></li></ul><li><div><span style="font-size: 16px;">过滤器配置详解</span></div></li><ul><li><div><span style="font-size: 16px;">拦截路径配置：</span></div></li><ul><li><div><span style="font-size: 16px;">具体的资源路径：</span><span style="font-size: 16px; color: rgb(255, 0, 0);">/index.jsp</span><span style="font-size: 16px;">--------只有访问index.jsp资源时，过滤器才会被执行</span></div></li><li><div><span style="font-size: 16px;">拦截目录：</span><span style="font-size: 16px; color: rgb(255, 0, 0);">/user/*</span><span style="font-size: 16px;">-------访问/user下的所有资源时，过滤器都会被执行</span></div></li><li><div><span style="font-size: 16px;">后缀名拦截：</span><span style="font-size: 16px; color: rgb(255, 0, 0);">*.jsp</span><span style="font-size: 16px;">--------访问所有后缀名为jsp资源时，过滤器都会被执行</span></div></li><li><div><span style="font-size: 16px;">拦截所有资源：</span><span style="font-size: 16px; color: rgb(255, 0, 0);">/*</span><span style="font-size: 16px;">---------访问所有的资源时都会被执行</span></div></li></ul><li><div><span style="font-size: 16px;"><span style="font-size: 16px; font-weight: bold;">拦截方式配置：资源被访问的方式</span></span></div></li><ul><li><div><span style="font-size: 16px;">注解配置</span></div></li><ul><li><div><span style="font-size: 16px;">设置</span><span style="font-size: 16px; color: rgb(227, 0, 0);">dispatcherTypes</span><span style="font-size: 16px;">属性</span></div></li><ul><li><div><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(255, 0, 0);">REQUEST:默认值。浏览器直接请求资源</span></span></div></li><ul><li><div><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(128, 128, 0); font-family: &quot;Droid Sans Mono&quot;;">@WebFilter</span><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(0, 0, 0); font-family: &quot;Droid Sans Mono&quot;;">(value=</span><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(0, 128, 0); font-family: &quot;Droid Sans Mono&quot;; font-weight: bold;">&quot;*.jsp&quot;</span><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(0, 0, 0); font-family: &quot;Droid Sans Mono&quot;;">,dispatcherTypes=DispatcherType.</span><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(102, 14, 122); font-family: &quot;Droid Sans Mono&quot;; font-style: italic; font-weight: bold;">REQUEST</span><span style="font-size: 12pt; color: rgb(0, 0, 0); font-family: &quot;Droid Sans Mono&quot;;">)</span></div></li></ul><li><div><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(255, 0, 0);">FORWARD:转发访问资源</span></span></div></li><li><div><span style="font-size: 12pt;">INCLUDE:包含访问资源</span></div></li><li><div><span style="font-size: 12pt;">ERROR:错误跳转资源</span></div></li><li><div><span style="font-size: 12pt;">ASYNC:异步访问资源</span></div></li></ul><li><div><span style="font-size: 12pt; color: rgb(128, 128, 0); font-family: &quot;Droid Sans Mono&quot;;">@WebFilter</span><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(0, 0, 0); font-family: &quot;Droid Sans Mono&quot;;">(value=</span><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(0, 128, 0); font-family: &quot;Droid Sans Mono&quot;; font-weight: bold;">&quot;/*&quot;</span><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(0, 0, 0); font-family: &quot;Droid Sans Mono&quot;;">,dispatcherTypes = {DispatcherType.</span><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(102, 14, 122); font-family: &quot;Droid Sans Mono&quot;; font-style: italic; font-weight: bold;">REQUEST</span><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(0, 0, 0); font-family: &quot;Droid Sans Mono&quot;;">,DispatcherType.</span><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(102, 14, 122); font-family: &quot;Droid Sans Mono&quot;; font-style: italic; font-weight: bold;">FORWARD</span><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(0, 0, 0); font-family: &quot;Droid Sans Mono&quot;;">})</span></div></li><li><div><span style="font-size: 12pt; font-family: &quot;Droid Sans Mono&quot;; font-style: italic;">@WebFilter(value=&quot;*.jsp&quot;,dispatcherTypes=DispatcherType.FORWARD)</span></div></li></ul><li><div><span style="font-size: 12pt;">web.xml配置</span></div></li><ul><li><div><span style="font-size: 16px;">设置&lt;dispatcher&gt;&lt;/dispatcher&gt;标签即可</span></div></li></ul></ul></ul><li><div><span style="font-size: 16px;">过滤器链（配置多个过滤器）<span style="font-size: 16px; color: rgb(255, 0, 0); font-weight: bold;">filterChain（对于一个请求，由多个filter过滤器组成的过滤器链）</span></span></div></li><ul><li><div><span style="font-size: 16px;"><span style="font-size: 16px; color: rgb(227, 0, 0);">注解配置执行顺序</span>：如果有两个过滤器1和过滤器2</span></div></li><ul><li><div><span style="font-size: 16px;">过滤器1--&gt;</span><span style="font-size: 16px;">过滤器2--&gt;</span><span style="font-size: 16px;">资源执行--&gt;</span><span style="font-size: 16px;">过滤器2</span><span style="font-size: 16px;">--&gt;</span><span style="font-size: 16px;">过滤器1</span></div></li></ul><li><div><span style="font-size: 16px;"><span style="font-size: 16px; color: rgb(255, 0, 0);">web.xml配置中过滤器先后顺序</span>问题：</span></div></li><ul><li><div><span style="font-size: 16px;">注解配置：</span><span style="font-size: 16px; color: rgb(255, 0, 0); font-weight: bold;">按照类名的字符串比较规则比较</span><span style="font-size: 16px;">，</span><span style="font-size: 16px; color: rgb(166, 0, 196); font-weight: bold;">值小的先执行</span></div></li><ul><li><div><span style="font-size: 16px;">如：AFilter&lt;BFilter,AFilter就先执行了</span></div></li></ul><li><div><span style="font-size: 12pt;">web.xml配置：<span style="font-size: 12pt; color: rgb(166, 0, 196); font-weight: bold;">&lt;filter-mapping&gt;谁定义在上边，谁先执行</span></span></div></li></ul></ul></ul></ul><div><img src="filter&listener_files/3.过滤敏感词汇.bmp" type="image/bmp" data-filename="3.过滤敏感词汇.bmp"/></div><ol><li><div><span style="font-size: 16px;"><span style="font-size: 16px; color: rgb(134, 0, 164); font-weight: bold;">增强对象的功能：</span></span></div></li><ol><li><div><span style="font-size: 16px;">设计模式：一些通用的解决问题的设计模式</span></div></li><li><div><span style="font-size: 16px;">装饰模式：</span></div></li><li><div><span style="font-size: 16px;">代理模式：</span></div></li><ol><li><div><span style="font-size: 16px;">概念：</span></div></li><ol><li><div><span style="font-size: 16px;">真实对象：被代理的对象</span></div></li><li><div><span style="font-size: 16px;">代理对象：</span></div></li><li><div><span style="font-size: 16px;">代理模式：代理对象代理真实对象，达到增强真实对象功能的目的</span></div></li></ol><li><div><span style="font-size: 16px;">实现方式：</span></div></li><ol><li><div><span style="font-size: 16px;">静态代理：有一个类文件描述代理模式</span></div></li><li><div><span style="font-size: 16px;"><span style="font-size: 16px; color: rgb(235, 0, 115); font-weight: bold;">动态代理</span>：在内存中形成代理类(java.lang.Proxy)</span></div></li><ol><li><div><span style="font-size: 16px;">实现步骤：</span></div></li><ol><li><div><span style="font-size: 16px;">代理对象和真实对象实现相同的接口</span></div></li><li><div><span style="font-size: 12pt;">代理对象 = Proxy.newProxyInstance();</span></div></li><li><div><span style="font-size: 16px;">使用代理对象调用方法</span></div></li><li><div><span style="font-size: 16px;">增强方法</span></div></li></ol><li><div><span style="font-size: 16px;">增强方式：</span></div></li><ol><li><div><span style="font-size: 16px;"><span style="font-size: 16px; color: rgb(255, 0, 0);">增强参数列表</span></span></div></li><li><div><span style="font-size: 16px;"><span style="font-size: 16px; color: rgb(255, 0, 0);">增强返回值类型</span></span></div></li><li><div><span style="font-size: 16px;"><span style="font-size: 16px; color: rgb(255, 0, 0);">增强方法体执行逻辑</span></span></div></li></ol><li><div><span style="font-size: 12pt;">三个参数：</span></div></li><ol><li><div><span style="font-size: 16px;">类加载器：真实对象.getClass().getClassLoader()</span></div></li><li><div><span style="font-size: 16px;">接口数组：真实对象.getClass().getInsterfaces()</span></div></li><li><div><span style="font-size: 16px;">处理器：new InvocationHandler()</span></div></li><ol><li><div><span style="font-size: 16px;">代理逻辑编写的方法：代理对象调用的所有方法都会触发该方法执行</span></div></li><li><div><span style="font-size: 16px;">参数：</span></div></li><ol><li><div><span style="font-size: 16px;">proxy：代理对象</span></div></li><li><div><span style="font-size: 16px;">method：代理对象调用的方法，被封装为IDE对象</span></div></li><li><div><span style="font-size: 16px;"> args：代理对象调用的方法时，传递的实际参数</span></div></li></ol></ol></ol></ol></ol></ol></ol></ol><div><span style="font-size: 16px;"><span style="font-size: 16px; color: rgb(255, 0, 0); font-weight: bold;">被代理的类一定要实现接口</span></span></div><div><span style="font-size: 16px;"><span style="font-size: 16px; color: rgb(209, 0, 255);">总结：所有的代理对象的方法执行，都会执行到InvocationHandler的invoke方法，我们就可以在这个方法中：</span></span></div><div><span style="font-size: 16px;"><span style="font-size: 16px; color: rgb(209, 0, 255);">    1.可以增强方法参数</span></span></div><div><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(209, 0, 255);">    2.可以增强返回值</span></span></div><div><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(209, 0, 255);">    3.可以增强方法逻辑</span></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>public class ProxyTest {</div><div>    public static void main(String[] args) {</div><div>        //1.创建真实类对象</div><div>        Asus asus = new Asus();</div><div>        //2.动态代理增强ASUS对象</div><div>        SaleComputer proxy = (SaleComputer) Proxy.newProxyInstance(asus.getClass().getClassLoader(), asus.getClass().getInterfaces(), new InvocationHandler() {</div><div>            @Override</div><div>            public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {</div><div>                System.out.println(&quot;动态逻辑方法被执行了。。。。。&quot;);</div><div>                System.out.println(&quot;方法名字：&quot; + method.getName());</div><div>                System.out.println(&quot;参数数组：&quot; + args[0]);</div><div>                return null;</div><div>            }</div><div>        });</div><div>        //3.调用方法</div><div>        String computer = proxy.saleComputer(39999);</div><div>        System.out.println(computer);</div><div><br/></div><div>    }</div><div>}</div></div><div><font style="font-size: 14pt;"><span style="font-size: 14pt; font-weight: bold;">二、Listener：监听器</span></font></div><ol><li><div><span style="font-size: 16px;">概念：<span style="font-size: 16px; color: rgb(255, 0, 0);">web三大组件之一，是一个类，用来监视其他类的变更或域的变化</span></span></div></li><ol><li><div><span style="font-size: 16px;">事件监听机制</span></div></li><ol><li><div><span style="font-size: 16px;">事件：一件事情</span></div></li><li><div><span style="font-size: 16px;">事件源：事件发生的地方</span></div></li><li><div><span style="font-size: 16px;">监听器：一个对象</span></div></li><li><div><span style="font-size: 16px;">注册监听：</span><span style="font-size: 16px; color: rgb(255, 0, 0);">将事件、事件源、监听器绑定在一起</span><span style="font-size: 16px;">，当事件源某一个状态发生变化，执行监听器代码</span></div></li></ol></ol><li><div><span style="font-size: 12pt;">ServletContextListener:监听ServletContext对象的创建和销毁</span></div></li><ol><li><div><span style="font-size: 16px;">方法：</span></div></li><ol><li><div><span style="font-size: 12pt;">void contextDestroyed(ServletContextEvent sce):ServletContext <span style="font-size: 12pt; color: rgb(166, 0, 196); font-weight: bold;">对象被销毁之前会调用该方法</span></span></div></li><li><div><span style="font-size: 12pt;">void contextInitialized(ServletContextEvent sce):ServletContext对象创建后会调用该方法</span></div></li></ol><li><div><span style="font-size: 16px;">步骤：</span></div></li><ol><li><div><span style="font-size: 16px;">定义一个类，实现ServletContextListener接口</span></div></li><li><div><span style="font-size: 16px;">复写方法</span></div></li><li><div><span style="font-size: 16px;">配置</span></div></li><ul><li><div><span style="font-size: 12pt;">web.xml</span></div></li></ul></ol></ol></ol><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>&lt;listener&gt;</div><div>    &lt;listener-class&gt;cn.itcast.web.listener.ContextLoaderListener&lt;/listenerclass&gt;</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">&lt;/listener&gt;</span></div><div><br/></div><div>指定初始化参数&lt;context-param&gt;</div></div><ul><ul><ul><ul><li><div><span style="font-size: 16px;">注解：</span><span style="font-size: 12pt;">@WebListener</span></div></li></ul></ul></ul></ul><div><font style="font-size: 12pt;"><br/></font></div><div><span style="font-size: 12pt;"><img src="filter&listener_files/day20-jQuery.png" type="image/png" data-filename="day20-jQuery.png"/></span></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><br/></div></div><div><br/></div></span>
</div></body></html> 